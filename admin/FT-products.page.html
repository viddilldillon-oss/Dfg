<!-- FT-products.page.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Products ‚Äî Supa Dillie-Cious Admin</title>

  <style>
    :root{
      --accent:#ffcc00;
      --glass:rgba(0,0,0,.55);
      --glass2:rgba(0,0,0,.35);
      --glow:0 10px 30px rgba(0,0,0,.35);
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:#fff;
      background:url("assets/supa.png") no-repeat center center fixed;
      background-size:cover;
      position:relative;
      overflow-x:hidden;
    }
    .overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.45));z-index:0}

    /* ===== SAME HEADER as your dashboard ===== */
    header{
      position:fixed;top:0;left:0;width:100%;z-index:10;
      display:flex;align-items:center;justify-content:center;
      padding:14px 22px;
      background:rgba(0,0,0,.5);backdrop-filter:blur(6px);
      box-shadow:var(--glow);
    }
    header h1{
      position:absolute;left:20px;top:50%;transform:translateY(-50%);
      margin:0;font-size:1.25rem;letter-spacing:.4px;color:var(--accent);
      text-shadow:0 2px 10px rgba(0,0,0,.6);
    }
    .menu-btn{
      font-size:26px;line-height:1;background:transparent;border:2px solid var(--accent);
      color:var(--accent);cursor:pointer;padding:6px 10px;border-radius:10px;
      transition:transform .2s ease, background .2s ease, color .2s ease;
    }
    .menu-btn:hover{transform:scale(1.05);background:var(--accent);color:#000}

    /* Centered dropdown menu (same as dashboard) */
    .menu{
      position:fixed;top:66px;left:50%;transform:translateX(-50%);z-index:12;
      width:230px;padding:10px 0;border-radius:12px;
      background:var(--glass);backdrop-filter:blur(8px);box-shadow:var(--glow);
      display:none;flex-direction:column;overflow:auto;max-height:70vh;
      border:1px solid rgba(255,255,255,.08);
      animation:fadeIn .25s ease;
    }
    .menu.show{display:flex}
    .menu a{
      color:#fff;text-decoration:none;padding:12px 16px;display:block;
      transition:background .2s ease;
    }
    .menu a:hover{background:rgba(255,204,0,.2)}
    .menu hr{border:0;border-top:1px solid rgba(255,255,255,.08);margin:6px 0}

    main{position:relative;z-index:1;max-width:900px;margin:120px auto 40px;padding:0 16px}

    /* Cards, inputs, buttons */
    .card{
      background:var(--glass);backdrop-filter:blur(8px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;padding:16px;box-shadow:var(--glow);
      animation:fadeUp .6s ease both;margin-bottom:16px;
    }
    h2{margin:.2rem 0 1rem;font-size:1.3rem;color:var(--accent)}
    label{display:block;margin-top:12px;font-weight:700}
    input,select,textarea{
      width:100%;padding:10px;margin-top:6px;border:none;border-radius:10px;
      background:rgba(255,255,255,.15);color:#fff;font-size:1rem;outline:none;
      backdrop-filter:blur(3px);transition:background .2s ease;
    }
    input:focus,select:focus,textarea:focus{background:rgba(255,255,255,.25)}
    select option{background:#222;color:#fff}
    input::file-selector-button{
      background:var(--accent);color:#000;border:none;border-radius:8px;
      padding:8px 12px;font-weight:800;cursor:pointer;margin-right:8px;
    }
    .btn{
      display:inline-block;background:var(--accent);color:#000;border:none;border-radius:12px;
      padding:12px 16px;font-weight:900;cursor:pointer;margin-top:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.35);transition:transform .2s ease, box-shadow .2s ease;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(255,204,0,.45)}

    /* Products list */
    .product-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;
    }
    .pcard{
      background:rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.08);border-radius:12px;
      padding:12px;
    }
    .pcard img{width:100%;height:150px;object-fit:cover;border-radius:8px;margin-bottom:8px}
    .pcard h3{margin:.25rem 0;color:var(--accent)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    @keyframes fadeUp{
      from{opacity:0;transform:translateY(10px)}
      to{opacity:1;transform:translateY(0)}
    }
    @keyframes fadeIn{
      from{opacity:0;transform:translate(-50%,-8px)}
      to{opacity:1;transform:translate(-50%,0)}
    }
  </style>
  <link rel="stylesheet" href="assets/hover-theme.css">
</head>
<body>
  <div class="overlay"></div>

  <!-- SAME header/burger as your dashboard -->
  <header>
    <h1>Products</h1>
    <button class="menu-btn" id="menuBtn" aria-label="Open menu">‚ò∞</button>
  </header>

  <!-- SAME centered dropdown as your dashboard -->
  <nav class="menu" id="menu">
    <a href="FT-dashboard.page.html">Dashboard</a>
    <a href="FT-products.page.html">Products</a>
    <a href="FT-orders.page.html">Orders</a>
    <a href="FT-sales.page.html">Sales</a>
    <a href="FT-suppliers.page.html">Suppliers</a>
    <hr>
    <a href="FT-settings.page.html">Settings</a>
    <a href="FT-logout.page.html">Logout</a>
  </nav>

  <main>
    <!-- Add Product -->
    <section class="card">
      <h2>Add New Product</h2>
      <form id="productForm">
        <label for="name">Product Name</label>
        <input id="name" type="text" placeholder="e.g., Chicken Breast" required>

        <label for="category">Category</label>
        <input id="category" type="text" placeholder="e.g., Fruits, Vegetables, Meat">

        <div class="row">
          <div>
            <label for="price">Price ($)</label>
            <input id="price" type="number" step="0.01" placeholder="e.g., 12.50" required>
          </div>
          <div>
            <label for="unitType">Unit Type</label>
            <select id="unitType">
              <option value="quantity">Quantity</option>
              <option value="pounds">Pounds</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="unitAmount">Unit Amount</label>
            <input id="unitAmount" type="number" step="0.01" placeholder="e.g., 1 (qty) or 2.5 (lbs)">
          </div>
          <div>
            <label for="stock">Stock (optional)</label>
            <input id="stock" type="number" step="1" placeholder="e.g., 100">
          </div>
        </div>

        <label for="description">Description (optional)</label>
        <textarea id="description" rows="3" placeholder="Short description..."></textarea>

        <label for="image">Product Image</label>
        <input id="image" type="file" accept="image/*" required>

        <button class="btn" type="submit">Add Product</button>
      </form>
    </section>

    <!-- Product List -->
    <section class="card">
      <h2>Products</h2>
      <input id="searchInput" type="text" placeholder="üîç Search products by name or category..." style="margin-bottom:16px">
      <div id="productsGrid" class="product-grid">
        <div class="pcard" style="opacity:.7;text-align:center">
          Loading products...
        </div>
      </div>
    </section>
  </main>

  <script>
    /* ===== Burger dropdown (same behavior as dashboard) ===== */
    const menuBtn = document.getElementById("menuBtn");
    const menu = document.getElementById("menu");
    menuBtn.addEventListener("click", ()=> menu.classList.toggle("show"));
    document.addEventListener("click", (e)=>{
      if (!menu.contains(e.target) && !menuBtn.contains(e.target)) menu.classList.remove("show");
    });

    /* ===== API helpers ===== */
    const API_ROOT = "http://localhost:5000/api";
    const token = localStorage.getItem("token");
    let allProducts = []; // Store all products for filtering

    // Create product via /api/upload (your Cloudinary+create route)
    async function createProduct(formData){
      const headers = {};
      if (token) headers["Authorization"] = `Bearer ${token}`;
      const res = await fetch(`${API_ROOT}/upload`, { method:"POST", headers, body: formData });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || "Upload failed");
      return data.product || data;
    }

    async function getProducts(){
      const res = await fetch(`${API_ROOT}/products`);
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || "Failed to load products");
      return Array.isArray(data) ? data : [];
    }

    async function deleteProduct(id){
      if (!confirm("Delete this product?")) return;
      const headers = {};
      if (token) headers["Authorization"] = `Bearer ${token}`;
      const res = await fetch(`${API_ROOT}/products/${id}`, { method:"DELETE", headers });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || "Failed to delete");
      await loadProducts();
    }

    function renderProducts(items){
      const grid = document.getElementById("productsGrid");
      grid.innerHTML = "";
      if (!items.length){
        const searchTerm = document.getElementById("searchInput").value.trim();
        const msg = searchTerm ? "No products match your search." : "No products yet.";
        grid.innerHTML = `<div class="pcard" style="opacity:.8;text-align:center">${msg}</div>`;
        return;
      }
      items.forEach(p=>{
        // handle cloudinary or local urls
        const img = p.imageUrl ? (p.imageUrl.startsWith("http") ? p.imageUrl : `${API_ROOT.replace("/api","")}${p.imageUrl}`) : "";
        const unit = [p.unitAmount, p.unitType].filter(Boolean).join(" ");
        grid.innerHTML += `
          <div class="pcard">
            ${img ? `<img src="${img}" alt="${p.name}">` : ``}
            <h3>${p.name || ""}</h3>
            ${p.category ? `<div style="color:var(--accent);font-size:.9rem">üìÅ ${p.category}</div>` : ``}
            <div>Price: $${Number(p.price||0).toFixed(2)}</div>
            <div>${unit ? `Unit: ${unit}` : ""}</div>
            ${typeof p.stock === "number" ? `<div>Stock: ${p.stock}</div>` : ``}
            ${p.description ? `<div style="opacity:.9;margin-top:6px">${p.description}</div>` : ``}
            <div style="margin-top:10px">
              <button class="btn" onclick="deleteProduct('${p._id}')">Delete</button>
            </div>
          </div>`;
      });
    }

    // Live search filter function
    function filterProducts(){
      const searchTerm = document.getElementById("searchInput").value.toLowerCase().trim();

      if (!searchTerm){
        renderProducts(allProducts);
        return;
      }

      const filtered = allProducts.filter(p => {
        // Search across all text fields
        const name = (p.name || "").toLowerCase();
        const description = (p.description || "").toLowerCase();
        const category = (p.category || "").toLowerCase();
        const unitType = (p.unitType || "").toLowerCase();

        // Combine all searchable text into one string
        const searchableText = `${name} ${description} ${category} ${unitType}`;

        return searchableText.includes(searchTerm);
      });

      renderProducts(filtered);
    }

    async function loadProducts(){
      try{
        allProducts = await getProducts();
        renderProducts(allProducts);
      }catch(err){
        console.error(err);
        document.getElementById("productsGrid").innerHTML =
          `<div class="pcard" style="opacity:.8;text-align:center">Failed to load products.</div>`;
      }
    }

    // Submit handler
    document.getElementById("productForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const fd = new FormData();
      fd.append("name", document.getElementById("name").value.trim());
      fd.append("category", document.getElementById("category").value.trim());
      fd.append("price", document.getElementById("price").value);
      fd.append("description", document.getElementById("description").value.trim());
      fd.append("unitType", document.getElementById("unitType").value);
      fd.append("unitAmount", document.getElementById("unitAmount").value);
      fd.append("stock", document.getElementById("stock").value);
      const file = document.getElementById("image").files[0];
      if (file) fd.append("image", file);

      try{
        await createProduct(fd);
        alert("‚úÖ Product added!");
        e.target.reset();
        loadProducts();
      }catch(err){
        console.error(err);
        alert("‚ùå " + err.message);
      }
    });

    // Live search event listener
    document.getElementById("searchInput").addEventListener("input", filterProducts);

    // Initial load
    loadProducts();
  </script>
</body>
</html>